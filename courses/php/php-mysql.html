<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Curso de PHP y MYSQL</title>
    <link rel="icon" href="../../src/images/favicon.png" type="img/text" />
    <link
      href="https://fonts.googleapis.com/css?family=Pacifico|Source+Sans+Pro&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.0/styles/monokai-sublime.min.css"
    />
    <link rel="stylesheet" href="../../src/css/styles.css" />
  </head>

  <body>
    <div class="app">
      <div class="app-react-basico">
        <header class="header">
          <div class="container-general">
            <nav class="header-menu">
              <ul class="header-menu__list menu-left">
                <li class="header-menu__list--item">
                  <a class="link" href="../../index.html">Inicio</a>
                </li>
                <li class="header-menu__list--item">
                  <a class="link" href="">Carreras</a>
                </li>
              </ul>
              <figure class="header-menu__logo">
                <a href="../../index.html"
                  ><img
                    class="header-menu__logo--img"
                    src="../../src/images/logo_white.png"
                    alt="logo carlos zabala"
                /></a>
              </figure>
              <ul class="header-menu__list menu-right">
                <li class="header-menu__list--item">
                  <a class="link" href="">Me</a>
                </li>
                <li class="header-menu__list--item">
                  <a class="link" href="">Contacto</a>
                </li>
              </ul>
            </nav>
          </div>
        </header>
        <section class="hero-course">
          <div class="container-general">
            <h1 class="hero-course__title">Curso de PHP y MYSQL</h1>
            <div class="hero-course__description">
              <p>
                Este es el primer curso donde manejo la administración de
                información en una base de datos usando como motor Mysql y como
                lenguaje Backend PHP, el curso es una mezcla de diversos sitios
                donde recopilo el conocimiento para afrontar estos nuevos retos.
              </p>
              <p>
                Es el inicio para poder conocer sobre los temas básicos y
                familiarizar sobre estos conceptos, y seguir avanzado más en el
                campo de la programación web.
              </p>
            </div>
            <div class="hero-course__buttons">
              <a
                target="_blank"
                href="https://www.youtube.com/watch?v=ZxrUVuOqsy0&list=PLPl81lqbj-4KPLqegK5DNKWSFBzn8QTbq"
                class="btn btn--primary"
                >Youtube Bluuweb!</a
              >
            </div>
          </div>
        </section>
        <section class="course-class">
          <div class="course-class__left" id="course-class__left">
            <div class="course-class__left--container">
              <nav class="course-class__menu">
                <ul>
                  <li>
                    <a class="link course-class__menu--a" href="#introduction"
                      >Introducción</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#conexion"
                      >Mysqli Conexión</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#insert"
                      >Mysqli Insertar</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#read"
                      >Mysqli Leer</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#update"
                      >Mysqli Actualizar</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#pdo">PDO</a>
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#conexion-pdo"
                      >PDO Conexión</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#consult-pdo"
                      >PDO Consultas</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#insert-pdo"
                      >PDO Insertar</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#update-pdo"
                      >PDO Update</a
                    >
                  </li>
                  <li>
                    <a
                      class="link course-class__menu--a"
                      href="#close-conection"
                      >Cerrar conexión</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#session"
                      >Sesiones</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#pass"
                      >Password Hash</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#htaccess"
                      >htaccess</a
                    >
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#api">API</a>
                  </li>
                  <li>
                    <a class="link course-class__menu--a" href="#mvc-binder"
                      >Orden carpetas MVC</a
                    >
                  </li>
                </ul>
              </nav>
            </div>
          </div>
          <div class="course-class__content">
            <i
              class="fas fa-bars icon course-class__icon-menu"
              id="btn-menu"
            ></i>
            <article class="course-class__section" id="introduction">
              <h2 class="course-class__section--title">Introducción</h2>
              <div class="course-class__section--content">
                <p>
                  Para conectarse a una base de datos usando PHP hay varias
                  formas,
                  <a
                    target="_blank"
                    class="link link-refe"
                    href="https://www.php.net/manual/es/book.mysqli.php"
                    >Mysqli</a
                  >,
                  <a
                    class="link link-refe"
                    target="_blank"
                    href="https://www.php.net/manual/es/book.pdo.php"
                    >PDO</a
                  >
                  o un ORM como
                  <a
                    class="link link-refe"
                    href="https://laravel.com/docs/5.8/eloquent"
                    >Eloquent</a
                  >, en este parte primero se iniciara con
                  <strong>Mysqli</strong>, se verá como conectarse a la base de
                  datos, y a realizar el famoso CRUD para el manejo de
                  información, luego se hará lo mismo pero usando
                  <strong>PDO</strong>.
                </p>
              </div>
            </article>
            <article class="course-class__section" id="conexion">
              <h2 class="course-class__section--title">
                Mysqli Configuración conexión
              </h2>
              <div class="course-class__section--content">
                <p>
                  Para la conexión se hace a través de una instancia de la clase
                  <strong>mysqli</strong>, de la siguiente manera:
                </p>
                <pre>
                  <code class="php">
                  //(ipservidor, nombreUsuario, contraseña, nombreBaseDatos)
                  $mysqli = mysqli("localhost", "root", "", "bd");
                
                  if ($mysqli->connect_error) {
                    die ('Error en la conexión ' . $mysqli->connect_error);
                  }
                  </code>
                </pre>
              </div>
            </article>
            <article class="course-class__section" id="insert">
              <h2 class="course-class__section--title">Mysqli Insertar</h2>
              <div class="course-class__section--content">
                <p>
                  Si usamos un formulario, utilizaremos el método
                  <strong>POST</strong> para el envió de datos.
                </p>
                <pre>
                  <code class="php">
                    &lt;php
                    require_once "conexion.php";

                    $name = $_POST['name']; 
                    $id = $_POST['id']; 

                    $radio = isset($_POST['radio']) ? $_POST['radio'] : 'no';
                  </code>
                </pre>
                <p>
                  Para el manejo de checkbox, se debe definir dentro del
                  elemento HTML, en la propiedad name un arreglo, para ir
                  almacenando los check que se van seleccionando.
                </p>
                <pre>
                  <code class="php">
                    #En HTML
                    &lt;input type="checkbox" name="interests[]" value="item1"&gt;
                    
                    #En PHP
                    $arrayToString = "";
                    $count = 1;
  
                    foreach ($arrayCheckbox as $key => $value) {
                      if (count($arrayCheckbox) != $count) {
                        $arrayToString .= $value . ", ";
                      } else {
                        $arrayToString .= $value;
                      }
  
                      $count++;
                    }
                  </code>
                </pre>
                <p>
                  Para insertar datos en la base de datos se hace llamando a la
                  instancia de la conexión <strong>mysqli</strong> creada en el
                  archivo <strong>conexion.php</strong> y usando el método
                  <strong>query</strong> se le pasa la consulta a realizar en la
                  base de datos.
                </p>
                <pre>
                  <code class="php">
                    $queryInsert  = "INSERT INTO table (campo1, campo2numerico, campo3)
                    VALUES ('$campo1', $campo2numerico, '$campo3')";
                    $response = $mysqli->query($queryInsert);
                  </code>
                </pre>
              </div>
            </article>
            <article class="course-class__section" id="read">
              <h2 class="course-class__section--title">Mysqli Leer</h2>
              <div class="course-class__section--content">
                <p>
                  Para consultar los datos se hace mediante el
                  <strong>select</strong>.
                </p>
                <pre>
                  <code class="php">
                    require_once('conexion.php');

                    $sqlSelect = "SELECT * FROM persona";
                    $response = $mysqli->query($sqlSelect);
                  </code>
                </pre>
                <p>
                  Para rescatar registro a registro los datos obtenidos por el
                  select debemos llamar a la función
                  <strong>fetch_array</strong>. Esta función retorna un
                  <strong>vector asociativo</strong> con los datos del registro
                  rescatado, o false en caso de no haber más registros. En el
                  ciclo while se ejecuta hasta que el método fetch_array
                  devuelva false.
                </p>
                <pre>
                  <code class="php">
                    while ($row = $response->fetch_array(MYSQLI_ASSOC)){...}
                  </code>
                </pre>
                <p>
                  Para rescatar cada campo accedemos mediante el vector
                  asociativo $row indicando como subíndice un campo contenido en
                  el select.
                </p>
                <pre>
                  <code class="php">
                    $row['nombre';
                  </code>
                </pre>
              </div>
            </article>
            <article class="course-class__section" id="update">
              <h2 class="course-class__section--title">Mysqli Actualizar</h2>
              <div class="course-class__section--content">
                <p>
                  Para actualizar, lo primero es configurar el botón o la acción
                  donde el usuario podrá actualizar los datos. Y para esto
                  necesitamos un campo <strong>clave</strong> sobre el registro
                  a editar, como por ejemplo el id, este campo se enviará por
                  <strong>GET</strong> a la página que se encargará de la
                  programación.
                </p>
                <pre>
                  <code class="php">
                    &lt;a href=&lt;?php echo"modificar.php?id=$row[id]"?&gt;&gt;&lt;/a&gt;
                  
                    #Ahora en el archivo
                    #Se obtiene el id mediante GET
                    $id = $_GET['id'];

                    $querySearchId ="SELECT* FROMpersona WHEREid = '$id'";
                    $response = $mysqli->query($querySearchId);

                    $row será el vector asosiativo con los datos del select anterior
                    $row = $response->fetch_array(MYSQLI_ASSOC);
                  </code>
                </pre>
                <p>
                  Podemos pasar datos ocultos en un formulario, sin que el
                  usuario lo visualice o lo modifique, esto es útil cuando
                  queremos pasar el id de un usuario por ejemplo.
                </p>
                <pre>
                  <code class="html">
                    &lt;input name="id" type="hidden" value=&lt;?php>echo "\"" . $row['id']  . "\"" ?&gt;"&gt;
                  </code>
                </pre>
              </div>
            </article>
            <article class="course-class__section" id="pdo">
              <h2 class="course-class__section--title">
                PDO
              </h2>
              <div class="course-class__section--content">
                <p>
                  La extensión Objetos de Datos de PHP (PDO por sus siglás en
                  inglés) define una interfaz ligera para poder acceder a bases
                  de datos en PHP. Cada controlador de bases de datos que
                  implemente la interfaz PDO puede exponer características
                  específicas de la base de datos, como las funciones habituales
                  de la extensión.
                  <a
                    href="https://www.php.net/manual/es/book.pdo.php"
                    class="link link-refe"
                    target="_blank"
                    >Documentación</a
                  >
                </p>
              </div>
            </article>
            <article class="course-class__section" id="conexion-pdo">
              <h2 class="course-class__section--title">Conexión con PDO</h2>
              <div class="course-class__section--content">
                <pre>
                  <code class="php">
                    define("DB_USER", "root")
                    define("DB_PASS", "root")
    
                    try{
                      $pdo = new PDO('mysql:host=localhost;dbname=prueba', DB_USER, DB_PASS);
                      $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
                      echo "Conexión realizada";
                    }
                    catch(PDOException $e){
                      print "Error" . $e->getMessage();
                      die();
                    }
                  </code>     
              </pre>
              </div>
            </article>
            <article class="course-class__section" id="consult-pdo">
              <h2 class="course-class__section--title">Consultas PDO</h2>
              <div class="course-class__section--content">
                <pre>
                  <code class="php">
                    $query_select = 'SELECT * FROM tabla_example';
                    $gsent = $pdo->prepare($quey_select);
                    $gsent->execute();

                    $result = $gsent->fetchAll();
                  </code>
                </pre>
                <p>
                  Si solo se va a obtener un resultado de la consulta, en vez de
                  usar <strong>fetchAll</strong> se usa solo
                  <strong>fetch</strong>.
                </p>
                <div class="note">
                  <p>
                    El método <strong>execute</strong>, devuelve TRUE o FALSE,
                    dependiendo si se completo con exito la consulta a la base
                    de datos.
                  </p>
                </div>
                <p>
                  Se puede recorrer el array resultado con un
                  <strong>foreach</strong>
                </p>
                <pre>
                  <code class="php">
                    &lt;?php foreach ($result as $data): ?&gt;

                      &lt;div class="container" &gt; 
                        ... $data ...
                      &lt;/div&gt;
                    &lt;?php endforeach ?&gt;
                  </code>
                </pre>
              </div>
            </article>
            <article class="course-class__section" id="insert-pdo">
              <h2 class="course-class__section--title">
                Insertar PDO, Sentencias preparadas
              </h2>
              <div class="course-class__section--content">
                <p>
                  Una Sentencia Preparada, o
                  <strong>Prepared Statement</strong>, es una característica de
                  algunos sistemas de bases de datos que permite ejecutar la
                  misma (o similar) sentencia SQL provocando una mejora en la
                  seguridad y en el rendimiento de la aplicación.
                </p>
                <p>
                  Muchas de las bases de datos más maduras admiten el concepto
                  de sentencias preparadas. Estas pueden definirse como un tipo
                  de plantillas compiladas para SQL que las aplicaciones quieren
                  ejecutar, pudiendo ser personalizadas utilizando parámetros
                  variables.
                  <a
                    href="https://www.php.net/manual/es/pdo.prepared-statements.php"
                    class="link link-refe"
                    target="_blank"
                    >Documentación</a
                  >
                </p>
              </div>
              <div class="note">
                <p>
                  Con las sentencias preparadas se evita la inyección de sql.
                </p>
              </div>
              <pre>
                <code class="php">
                  if($_POST){
                    $valor1 = $_POST["campo1];
                    $valor2 = $_POST["campo2];
                    
                    $sql_add = 'INSERT INTO table (campo1, campo2) VALUES (?,?)';
                    $stmadd = $pdo->prepare($sql_add);
                    $stmadd->execute(array($valor1, $valor2));
                    
                    #Para que se recargue la página y se vean los cambios
                    header('location:index.php');
                  }
                </code> 
              </pre>
            </article>
            <article class="course-class__section" id="update-pdo">
              <h2 class="course-class__section--title">
                Update y Delete PDO
              </h2>
              <div class="course-class__section--content">
                <p>
                  Para implementar el update o el delete, es necesario obtener
                  el id del elemento a modificar en base de datos, y para
                  obtener el id, se puede hacer mediante el método
                  <strong>GET</strong>.
                </p>
                <pre>
                  <code class="php">
                    $id = $_GET["id"];
                    $valor1 = $_GET["valor1"];
                    $valor2 = $_GET["valor2"];

                    $query_update = "UPDATE table SET campo1 = ?, campo2 = ? WHERE id = ?";
                    $stmt = $pdo->prepare($query_update);
                    $stmt->execute($valor1, $valor2, $id);
                  </code>
                </pre>
                <p>
                  Para la acción de eliminar sería la siguiente, aunque se
                  recomienda hacer una validación previa con Js, preguntandolé
                  al usuario si realmente quiere borrar el registro.
                </p>
                <pre>
                  <code class="php">
                    $query_delete = "DELETE FROM table WHERE id = ?";
                    $stmt = $pdo->prepare($query_delete);
                    $stmt->execute($id);
                  </code>
                </pre>
              </div>
            </article>
            <article class="course-class__section" id="close-conection">
              <h2 class="course-class__section--title">Cerrar conexión PDO</h2>
              <div class="course-class__section">
                <p>
                  Para cerrar una conexión en PDO, solo basta con volver null,
                  la instancia de la clase PDO, asi como también la variable
                  statement.
                </p>
                <pre>
                  <code class="php">
                    $pdo = null;
                    $stmt = null;
                  </code>
                </pre>
              </div>
            </article>
            <article class="course-class__section" id="session">
              <h2 class="course-class__section--title">Sesiones</h2>
              <div class="course-class__section--content">
                <p>
                  Se utiliza mucho para dar u otorgar permisos especificos a los
                  usuarios que inicien sesión en una página. Para esto se usa
                  una variable superglobal
                  <a
                    href="https://www.php.net/manual/es/reserved.variables.session.php"
                    target="_blank"
                    class="link link-refe"
                    ><strong>$_SESSION</strong></a
                  >, que es un array asociativo que contiene variables de sesión
                  disponibles para el script actual.
                </p>
                <p>
                  Para tener ese array asosiativo de sesiones en todos los
                  archivos php, se debe colocar al inicio de cada archivo la
                  función <strong>session_start</strong>, que permitira acceder
                  de manera global a nuestras sesiones.
                </p>
                <pre>
                  <code class="php">
                    session_start();

                    $login = "usuario";

                    #En vez de admin, puede ser cualquier nombre
                    $_SESSION["admin"] = $login;

                    #Para validar si la sesión existe se usa isset
                    isset($_SESSION["admin"]);
                  </code>
                </pre>
                <p>
                  Para destruir una sesión se emplea el método
                  <a
                    class="link link-refe"
                    target="_blank"
                    href="https://www.php.net/manual/es/function.session-destroy.php"
                    ><strong>session_destroy</strong></a
                  >.
                </p>
              </div>
            </article>
            <article class="course-class__section" id="pass">
              <h2 class="course-class__section--title">Password Hash</h2>
              <div class="course-class__section--content">
                <p>
                  Para el manejo de contraseñas en php se recomienda usar la
                  encriptación que ofrece
                  <a
                    class="link link-refe"
                    target="_blank"
                    href="https://www.php.net/manual/es/function.password-hash.php"
                    >password_hash</a
                  >, el cual crea un nuevo hash de contraseña usando un
                  algoritmo de hash fuerte de único sentido. En la columna de la
                  base de datos donde se almacenara ese hash, debe permitir
                  hasta 255 caracteres para evitar errores.
                </p>
                <pre>
                  <code class="php">
                    password_hash("Password", PASSWORD_DEFAULT);
                  </code>
                </pre>
                <p>
                  Para hacer comparación entre contraseñas se usa
                  <a
                    class="link link-refe"
                    target="_blank"
                    href="https://www.php.net/manual/es/function.password-verify.php"
                    >password_verify</a
                  >, devuelve <b>TRUE</b> si la contraseña y el hash coinciden,
                  o <b>FALSE</b> de lo contrario.
                </p>
                <pre>
                  <code class="php">
                    password_verify("passwordCompare", $hash);
                  </code>
                </pre>
              </div>
            </article>
            <article class="course-class__section" id="htaccess">
              <h2 class="course-class__section--title">htaccess</h2>
              <div class="course-class__section--content">
                <p>
                  Es el nombre por defecto del archivo de configuración de
                  directorios de Apache. Se utiliza para personalizar la
                  configuración de directivas y parámetros definidos en el
                  archivo de configuración principal del alojamiento.
                </p>

                <ul>
                  <li>
                    Expesiones regulares, valores que va a aceptar nuestra url.
                    <ol>
                      <li><b>(^)</b>, inicio de los caracteres a aceptar.</li>
                      <li>
                        <b>(a-zA-Z)</b>, aceptar de la (A) a la (Z), tanto en
                        mayúsculas como en minúsculas.
                      </li>
                      <li><b>(0-9)</b>, para los números.</li>
                      <li>
                        <b>(*)</b> Para configurar que será una combinación de
                        caracteres.
                      </li>
                    </ol>
                  </li>
                </ul>

                <pre>
                  <code class="php">
                    #En el archivo .htaccess
                    Options +FollowSymLinks #Compartiendo los enlaces
                    RewriteEngine On #Reescribir la url

                    #Funcion que va a redirigir a la url especifica
                    #RewriteRule ExpresionRegular UrlDestino [banderas_config_opcional]
                    RewriteRule ^([a-zA-Z0-9]*)$ datos.php?route=$1
                  </code>
                </pre>
                <p>
                  Hay que capturar lo que se ingrese en la ruta y guardarlo en
                  una variable, por medio de <b>GET</b>.
                </p>
                <pre>
                  <code class="php">
                    $peticionUrl = $_GET["route"];
                  </code>
                </pre>
              </div>
            </article>
            <article class="course-class__section" id="api">
              <h2 class="course-class__section--title">API</h2>
              <div class="course-class__section--content">
                <p>
                  Para trabajar con APIs desde PHP, hay que usar la función
                  <strong>json_encode</strong>, que convertira un array de php a
                  objeto tipo Json, el cual luego podemos manipular con
                  Javascript, en el frontend de la aplicación.
                </p>
                <pre>
                  <code class="php">
                    echo json_encode($array);
                  </code>
                </pre>
                <p>
                  También hay que especificar en PHP, que el archivo que vamos a
                  exportar es un JSON, eso se hace a través de la cabecera. Se
                  colocá al comienzo del archivo PHP.
                </p>
                <pre>
                  <code class="php">
                    header('Content-Type: application/json');
                  </code>
                </pre>
                <p>
                  Otra parte importante son los
                  <a
                    class="link link-refe"
                    target="_blank"
                    href="https://victorroblesweb.es/2017/04/23/cabeceras-http-php-permitir-acceso-cors/"
                    >CORS</a
                  >, esto se configura en el archivo PHP, para que cualquier
                  persona pueda consumir una API.
                </p>
                <pre>
                  <code class="php">
                    header('Access-Control-Allow-Origin: *');
                  </code>
                </pre>
              </div>
            </article>
            <article class="course-class__section" id="mvc-binder">
              <h2 class="course-class__section--title">Oden de carpetas MVC</h2>
              <div class="course-class__section--content">
                <p>
                  Las carpetas a tener encuenta para dividir el programa en MVC,
                  podría ser la siguiente:
                </p>
                <ul>
                  <li>Assets</li>
                  <li>Config</li>
                  <li>Controllers</li>
                  <li>Helpers</li>
                  <li>Libraries</li>
                  <li>Models</li>
                  <li>Views</li>
                  <li>.htaccess</li>
                  <li>index.php</li>
                </ul>
                <pre>
                  <code class="php">
                    #Archivo .htaccess
                    Options All -Indexes #Para que no se pueda navegar entre los directorios
                    RewriteEngine on

                    RewriteCond %{REQUEST_FILENAME} !-d
                    RewriteCond %{REQUEST_FILENAME} !-f
                    RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]
                  </code>
                </pre>
              </div>
            </article>
          </div>
        </section>
        <footer class="footer">
          <div class="container-general">
            <div class="footer__container">
              <p id="footer-year">@Carlos Zabala Roqueme -</p>
              <figure class="footer__container--img">
                <img
                  src="../../src/images/logo-white-2.png"
                  alt="logo Carlos Zabala"
                />
              </figure>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <script
      src="https://kit.fontawesome.com/2028b75fa6.js"
      crossorigin="anonymous"
    ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.0/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
    <script src="../../src/js/menu.js"></script>
    <script type="module" src="../../index.js"></script>
  </body>
</html>
